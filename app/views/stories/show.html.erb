<% if @user && Invite.find_by_user_id_and_story_id(@user.id, params[:id]) && Story.find(params[:id]).private_story == true || Story.find(params[:id]).private_story == false %>


<div id="content">
  <h1 id="story_title"><%= @story.title %></h1>
  <div id="story">

    <ul class="lines">
      <% @story_lines.each do |line| %>
      <li><%= line.content %></li>
      <% end %>
    </ul>

    <%= form_for @new_submission do |f| %>
    <%= f.text_field :content %>
    <%= f.submit "Create Line" %>
    <% end %>

    <ul class="submissions">
      <% @story_submissions.each do |submission| %>
      <li><p>
      	<%= submission.content %>
      	</p>
      	<span>
      	<%= form_tag "/stories/#{params[:id]}/submission", :method => "put", :id => "vote" do %>
      		<%= hidden_field_tag "vote_count", 1 %>
      		<%= hidden_field_tag "submission_id", submission.id %>
      		<%= submit_tag "Vote" %>
      	<% end %>
      	<%= submission.votes %>
      	</span>	
      </li>
      <% end %>
    </ul>

  </div><!-- #story -->
  <div class="bottom_pad"></div>
</div><!-- #content -->  
<div id="sidebar">
	<div class="sidebar_widget">
	<% if Story.find(params[:id]).private_story == false %>
	<% else %>
	  <h2>This Story's Users</h2>
	  <ul class="story_users">
	    <% @story_invites.each do |invite| %>
	    <li><%= link_to invite.user.name, "/users/#{invite.user.id}" %></li>
	    <% end %>
	  </ul>
	  <%= form_tag "/stories/#{params[:id]}", method: "put", id: "invite_form" do %>
	  <%= label_tag :q, "Enter user's name to add a collaborator to this story" %>
	  <%= text_field_tag :q %>
	  <%= submit_tag "Submit" %>
	  <% end %>
	  <p class="error"><%= flash[:notice] %></p>
	<% end %>
	  <%= link_to "All Stories", root_url %>
	</div><!-- sidebar_widget -->
</div><!-- #sidebar -->

<% else %>
<div id ="content">
<h1 id="story_title">YOU SHALL NOT PASS!</h1>
  <div id="story">
		<p>Seriously, you aren't allowed to view this story.</p>
	</div><!-- story -->
	<div class="bottom_pad"></div>
</div><!-- content -->
<% end %>

